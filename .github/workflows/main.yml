name: Build EZ-Theme ğŸš€

on:
  workflow_dispatch:   # ğŸ‘‰ æ‰‹åŠ¨è§¦å‘æ„å»º

jobs:
  build:
    runs-on: ubuntu-latest

    steps:
      # ğŸŸ¢ ç¬¬ 1 æ­¥ï¼šæ‹‰å–ä»£ç 
      - name: ğŸ“¥ Checkout ä»£ç 
        uses: actions/checkout@v4   # âœ… æœ€æ–°ç‰ˆ

      # ğŸŸ¢ ç¬¬ 2 æ­¥ï¼šè®¾ç½® Node.js ç¯å¢ƒ
      - name: ğŸ› ï¸ å®‰è£… Node.js ç¯å¢ƒ
        uses: actions/setup-node@v4   # âœ… æœ€æ–°ç‰ˆ
        with:
          node-version: 20            # âœ… LTS æœ€æ–°ç¨³å®šç‰ˆ

      # ğŸŸ¢ ç¬¬ 3 æ­¥ï¼šå®‰è£…ä¾èµ–
      - name: ğŸ“¦ å®‰è£…é¡¹ç›®ä¾èµ–
        run: |
          echo "ğŸ” å¼€å§‹å®‰è£…ä¾èµ–..."
          npm install --legacy-peer-deps
          echo "âœ… ä¾èµ–å®‰è£…å®Œæˆï¼"

      # ğŸŸ¢ ç¬¬ 4 æ­¥ï¼šè¡¥å……ç¼ºå¤±ä¾èµ–
      - name: ğŸ§© ä¿®å¤ç¼ºå¤±ä¾èµ–
        run: |
          echo "ğŸ”§ å®‰è£… defu ä¾èµ–..."
          npm install defu --save
          echo "âœ… ç¼ºå¤±ä¾èµ–å®‰è£…å®Œæˆï¼"

      # ğŸŸ¢ ç¬¬ 5 æ­¥ï¼šè‡ªåŠ¨ä¿®å¤å®‰å…¨é—®é¢˜ï¼ˆå¯é€‰ï¼‰
      - name: ğŸ›¡ï¸ å®‰å…¨ä¿®å¤ï¼ˆéå¿…é¡»ï¼‰
        run: |
          echo "ğŸ” æ£€æŸ¥å®‰å…¨æ¼æ´..."
          npm audit fix || true
          echo "âœ… å®‰å…¨é—®é¢˜å·²å°½é‡ä¿®å¤"

      # ğŸŸ¢ ç¬¬ 6 æ­¥ï¼šæ„å»ºé¡¹ç›®
      - name: ğŸ—ï¸ æ„å»ºé¡¹ç›®
        run: |
          echo "âš™ï¸ å¼€å§‹æ„å»º..."
          npm run build
          echo "âœ… æ„å»ºå®Œæˆï¼"

      # ğŸŸ¢ ç¬¬ 7 æ­¥ï¼šæ‰“åŒ…æ„å»ºäº§ç‰©
      - name: ğŸ“¦ å‹ç¼©æ„å»ºç»“æœ
        run: |
          zip -r ez-theme-dist.zip dist
          echo "âœ… å·²ç”Ÿæˆå‹ç¼©åŒ…ï¼šez-theme-dist.zip"

      # ğŸŸ¢ ç¬¬ 8 æ­¥ï¼šä¸Šä¼ æ„å»ºäº§ç‰©
      - name: â˜ï¸ ä¸Šä¼ æ‰“åŒ…äº§ç‰©
        uses: actions/upload-artifact@v4   # âœ… æœ€æ–°ç‰ˆ
        with:
          name: ez-theme-dist
          path: |
            dist
            ez-theme-dist.zip
